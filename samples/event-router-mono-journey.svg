<?xml version="1.0" encoding="UTF-8"?>
<svg width="1750" height="1500" viewBox="0 0 1750 1500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <filter id="sceneShadow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.25"/></filter>
<filter id="busGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
<linearGradient id="roadGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#404040"/><stop offset="0.5" stop-color="#505050"/><stop offset="1" stop-color="#404040"/></linearGradient>
<linearGradient id="busGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#FFD700"/><stop offset="0.5" stop-color="#FFA500"/><stop offset="1" stop-color="#FFD700"/></linearGradient>
    
      <clipPath id="scene-1-clip">
        <rect x="50" y="150" width="800" height="400" rx="8" ry="8"/>
      </clipPath>

      <clipPath id="scene-2-clip">
        <rect x="900" y="150" width="800" height="400" rx="8" ry="8"/>
      </clipPath>

      <clipPath id="scene-3-clip">
        <rect x="50" y="600" width="800" height="400" rx="8" ry="8"/>
      </clipPath>

      <clipPath id="scene-4-clip">
        <rect x="900" y="600" width="800" height="400" rx="8" ry="8"/>
      </clipPath>

      <clipPath id="scene-5-clip">
        <rect x="50" y="1050" width="800" height="400" rx="8" ry="8"/>
      </clipPath>

      <clipPath id="scene-6-clip">
        <rect x="900" y="1050" width="800" height="400" rx="8" ry="8"/>
      </clipPath>
  </defs>

  <style>
    .scene-boundary {
      overflow: hidden;
    }
    .scene-content {
      clip-path: inherit;
    }
    .scene-title {
      font-family: Arial, sans-serif;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
    }
  </style>

  <!-- Background -->
  <rect width="100%" height="100%" fill="#87CEEB"/>

  <!-- Title -->
  <text x="875" y="40" text-anchor="middle"
        font-family="Arial, sans-serif"
        font-size="32"
        font-weight="bold"
        fill="#1E3A56">
    EventRouter Journey: Graph-Generated Storybook Layout
  </text>

  <!-- Subtitle -->
  <text x="875" y="70" text-anchor="middle"
        font-family="Arial, sans-serif"
        font-size="18"
        fill="#3C556E">
    Seamless Bus Journey Through All EventRouter Scenes
  </text>

  <!-- Connection paths -->
  <path d="M 850,350 Q 875,350 900,350" stroke="#FFD700" stroke-width="4" fill="none" opacity="0.5" stroke-dasharray="10,5"/>
<path d="M 1700,350 Q 875,575 50,800" stroke="#FFD700" stroke-width="4" fill="none" opacity="0.5" stroke-dasharray="10,5"/>
<path d="M 850,800 Q 875,800 900,800" stroke="#FFD700" stroke-width="4" fill="none" opacity="0.5" stroke-dasharray="10,5"/>
<path d="M 1700,800 Q 875,1025 50,1250" stroke="#FFD700" stroke-width="4" fill="none" opacity="0.5" stroke-dasharray="10,5"/>
<path d="M 850,1250 Q 875,1250 900,1250" stroke="#FFD700" stroke-width="4" fill="none" opacity="0.5" stroke-dasharray="10,5"/>

  <!-- Scene boundaries and content -->
  
      <g id="scene-1" class="scene-boundary" transform="translate(50, 150)">
        <!-- Scene background -->
        <rect x="0" y="0" width="800" height="400"
              fill="#87CEEB"
              stroke="#1976D2"
              stroke-width="2"
              rx="8"
              ry="8"/>

        <!-- Scene title -->
        <text x="400" y="25" text-anchor="middle"
              class="scene-title"
              font-size="16"
              fill="#1976D2">
          Scene 1: 1 RX-NODE-73EKE9
        </text>

        <!-- Scene content with enforced clipping -->
        <g class="scene-content" clip-path="url(#scene-1-clip)">
          <g transform="translate(0, 40)">
            <!-- Scene 1: The bus leaving the depot with animations -->
            <!-- Background sky -->
            <rect x="0" y="0" width="800" height="250" fill="#87CEEB"></rect>
            <!-- Clouds -->
            <g fill="#FFFFFF" opacity="0.8">
            <!-- Cloud 1 -->
            <circle cx="150" cy="60" r="20"></circle>
            <circle cx="170" cy="60" r="15"></circle>
            <circle cx="130" cy="65" r="12"></circle>
            <circle cx="165" cy="50" r="10"></circle>
            <!-- Cloud 2 -->
            <circle cx="600" cy="80" r="25"></circle>
            <circle cx="625" cy="80" r="18"></circle>
            <circle cx="580" cy="85" r="15"></circle>
            <circle cx="620" cy="65" r="12"></circle>
            <!-- Cloud 3 -->
            <circle cx="400" cy="50" r="18"></circle>
            <circle cx="420" cy="50" r="12"></circle>
            <circle cx="385" cy="55" r="10"></circle>
            </g>
            <!-- Ground/grass verges -->
            <rect x="0" y="250" width="800" height="150" fill="#4A6B3A"></rect>
            <!-- Road -->
            <rect x="0" y="280" width="800" height="60" fill="#404040"></rect>
            <!-- Road edges -->
            <rect x="0" y="278" width="800" height="2" fill="#606060"></rect>
            <rect x="0" y="340" width="800" height="2" fill="#606060"></rect>
            <!-- Dashed center line -->
            <g fill="#FFFF00">
            <rect x="50" y="308" width="40" height="4"></rect>
            <rect x="120" y="308" width="40" height="4"></rect>
            <rect x="190" y="308" width="40" height="4"></rect>
            <rect x="260" y="308" width="40" height="4"></rect>
            <rect x="330" y="308" width="40" height="4"></rect>
            <rect x="400" y="308" width="40" height="4"></rect>
            <rect x="470" y="308" width="40" height="4"></rect>
            <rect x="540" y="308" width="40" height="4"></rect>
            <rect x="610" y="308" width="40" height="4"></rect>
            <rect x="680" y="308" width="40" height="4"></rect>
            <rect x="750" y="308" width="40" height="4"></rect>
            </g>
            <!-- Depot building -->
            <g id="depot">
            <!-- Main building structure -->
            <rect x="50" y="150" width="200" height="130" fill="#8B7355" stroke="#6B5535" stroke-width="2"></rect>
            <!-- Roof -->
            <polygon points="40,150 150,110 260,110 260,150" fill="#654321" stroke="#543210" stroke-width="2"></polygon>
            <!-- Front overhang -->
            <polygon points="45,150 45,140 255,140 255,150" fill="#765432" stroke="#654321" stroke-width="1"></polygon>
            <!-- Garage door -->
            <rect x="80" y="200" width="60" height="80" fill="#666" stroke="#444" stroke-width="2" rx="3"></rect>
            <rect x="160" y="200" width="60" height="80" fill="#666" stroke="#444" stroke-width="2" rx="3"></rect>
            <!-- Garage door panels -->
            <g stroke="#555" stroke-width="1" fill="none">
            <line x1="80" y1="215" x2="140" y2="215"></line>
            <line x1="80" y1="230" x2="140" y2="230"></line>
            <line x1="80" y1="245" x2="140" y2="245"></line>
            <line x1="80" y1="260" x2="140" y2="260"></line>
            <line x1="160" y1="215" x2="220" y2="215"></line>
            <line x1="160" y1="230" x2="220" y2="230"></line>
            <line x1="160" y1="245" x2="220" y2="245"></line>
            <line x1="160" y1="260" x2="220" y2="260"></line>
            </g>
            <!-- Depot sign -->
            <rect x="100" y="160" width="100" height="20" fill="#FFFFFF" stroke="#333" stroke-width="1" rx="3"></rect>
            <text x="150" y="173" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">SCHOOL BUS DEPOT</text>
            </g>
            <!-- School bus with movement animation -->
            <g id="school-bus" transform="translate(300, 250)">
            <!-- Bus movement animation from left to right -->
            <animateTransform attributeName="transform" type="translate" values="300,250; 900,250" dur="8s" repeatCount="indefinite"/>
            <!-- Bus body -->
            <rect x="0" y="0" width="120" height="40" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="2"></rect>
            <!-- Bus front -->
            <rect x="115" y="3" width="12" height="34" rx="6" ry="6" fill="#FFD700" stroke="#E6C200" stroke-width="2"></rect>
            <!-- Bus roof -->
            <rect x="-2" y="-3" width="124" height="6" rx="3" ry="3" fill="#FFA500"></rect>
            <!-- Front bumper -->
            <rect x="125" y="35" width="8" height="4" rx="2" ry="2" fill="#C0C0C0"></rect>
            <!-- Windows (tinted dark) -->
            <rect x="110" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="100" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="90" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="80" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="70" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="60" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="50" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="40" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="30" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="20" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="10" y="6" width="8" height="12" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <!-- Emergency exit window -->
            <rect x="5" y="8" width="6" height="8" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <!-- Door -->
            <rect x="95" y="22" width="12" height="18" rx="1" ry="1" fill="#E6C200" stroke="#D4AF37" stroke-width="1"></rect>
            <rect x="97" y="24" width="8" height="8" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <circle cx="99" cy="35" r="1" fill="#000"></circle>
            <!-- School Bus text -->
            <text x="60" y="28" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#000">SCHOOL BUS</text>
            <!-- Orange stripe -->
            <rect x="0" y="20" width="120" height="4" fill="#FFA500"></rect>
            <!-- Front headlight (glowing) -->
            <circle cx="123" cy="12" r="3" fill="#FFFF00">
            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"></animate>
            </circle>
            <!-- Rear lights -->
            <rect x="2" y="8" width="3" height="4" rx="1.5" ry="1.5" fill="#FF0000"></rect>
            <rect x="2" y="28" width="3" height="4" rx="1.5" ry="1.5" fill="#FF0000"></rect>
            <!-- Front wheel with spinning spokes -->
            <g id="front-wheel">
            <circle cx="25" cy="42" r="8" fill="#333" stroke="#222" stroke-width="2"></circle>
            <circle cx="25" cy="42" r="4" fill="#666"></circle>
            <circle cx="25" cy="42" r="2" fill="#999"></circle>
            <g transform-origin="25 42">
            <line x1="25" y1="36" x2="25" y2="48" stroke="#AAA" stroke-width="1"></line>
            <line x1="19" y1="42" x2="31" y2="42" stroke="#AAA" stroke-width="1"></line>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            <!-- Rear wheel with spinning spokes -->
            <g id="rear-wheel">
            <circle cx="95" cy="42" r="8" fill="#333" stroke="#222" stroke-width="2"></circle>
            <circle cx="95" cy="42" r="4" fill="#666"></circle>
            <circle cx="95" cy="42" r="2" fill="#999"></circle>
            <g transform-origin="95 42">
            <line x1="95" y1="36" x2="95" y2="48" stroke="#AAA" stroke-width="1"></line>
            <line x1="89" y1="42" x2="101" y2="42" stroke="#AAA" stroke-width="1"></line>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            </g>
            <!-- Sky Text -->
            <g id="sky-text" transform="translate(400, 40)">
            <!-- Bold headline -->
            <text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">Every journey starts with a <tspan fill="#FFD700">publish</tspan>.</text>
            <!-- Supporting description -->
            <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">The depot launches the event onto the route.</text>
            </g>
            <!-- Caption -->
            <g id="caption" transform="translate(400, 370)">
            <rect x="-150" y="-10" width="300" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"></rect>
            <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Bus leaves depot → publish(topic, payload)</text>
            </g>
          </g>
        </g>
      </g>
    

      <g id="scene-2" class="scene-boundary" transform="translate(900, 150)">
        <!-- Scene background -->
        <rect x="0" y="0" width="800" height="400"
              fill="#87CEEB"
              stroke="#1976D2"
              stroke-width="2"
              rx="8"
              ry="8"/>

        <!-- Scene title -->
        <text x="400" y="25" text-anchor="middle"
              class="scene-title"
              font-size="16"
              fill="#1976D2">
          Scene 2: 2 RX-NODE-S1WPLC
        </text>

        <!-- Scene content with enforced clipping -->
        <g class="scene-content" clip-path="url(#scene-2-clip)">
          <g transform="translate(0, 40)">
            <!-- Scene 2: Bus encountering first rules of the road with animations -->
            <!-- Background sky -->
            <rect x="0" y="0" width="800" height="250" fill="#87CEEB"></rect>
            <!-- Clouds -->
            <g fill="#FFFFFF" opacity="0.8">
            <circle cx="120" cy="50" r="18"></circle>
            <circle cx="140" cy="50" r="12"></circle>
            <circle cx="105" cy="55" r="10"></circle>
            <circle cx="650" cy="70" r="22"></circle>
            <circle cx="675" cy="70" r="16"></circle>
            <circle cx="630" cy="75" r="12"></circle>
            <circle cx="400" cy="40" r="15"></circle>
            <circle cx="415" cy="40" r="10"></circle>
            <circle cx="390" cy="45" r="8"></circle>
            </g>
            <!-- Ground -->
            <rect x="0" y="250" width="800" height="150" fill="#4A6B3A"></rect>
            <!-- Road -->
            <rect x="0" y="280" width="800" height="60" fill="#404040"></rect>
            <rect x="0" y="278" width="800" height="2" fill="#606060"></rect>
            <rect x="0" y="340" width="800" height="2" fill="#606060"></rect>
            <!-- Guardrails -->
            <rect x="0" y="265" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"></rect>
            <rect x="0" y="345" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"></rect>
            <!-- Guardrail posts -->
            <g fill="#C0C0C0">
            <rect x="50" y="260" width="4" height="18"></rect>
            <rect x="150" y="260" width="4" height="18"></rect>
            <rect x="250" y="260" width="4" height="18"></rect>
            <rect x="350" y="260" width="4" height="18"></rect>
            <rect x="450" y="260" width="4" height="18"></rect>
            <rect x="550" y="260" width="4" height="18"></rect>
            <rect x="650" y="260" width="4" height="18"></rect>
            <rect x="750" y="260" width="4" height="18"></rect>
            <rect x="50" y="345" width="4" height="18"></rect>
            <rect x="150" y="345" width="4" height="18"></rect>
            <rect x="250" y="345" width="4" height="18"></rect>
            <rect x="350" y="345" width="4" height="18"></rect>
            <rect x="450" y="345" width="4" height="18"></rect>
            <rect x="550" y="345" width="4" height="18"></rect>
            <rect x="650" y="345" width="4" height="18"></rect>
            <rect x="750" y="345" width="4" height="18"></rect>
            </g>
            <!-- Dashed center line -->
            <g fill="#FFFF00">
            <rect x="50" y="308" width="40" height="4"></rect>
            <rect x="120" y="308" width="40" height="4"></rect>
            <rect x="190" y="308" width="40" height="4"></rect>
            <rect x="260" y="308" width="40" height="4"></rect>
            <rect x="330" y="308" width="40" height="4"></rect>
            <rect x="400" y="308" width="40" height="4"></rect>
            <rect x="470" y="308" width="40" height="4"></rect>
            <rect x="540" y="308" width="40" height="4"></rect>
            <rect x="610" y="308" width="40" height="4"></rect>
            <rect x="680" y="308" width="40" height="4"></rect>
            </g>
            <!-- School bus with stop-and-go animation -->
            <g id="school-bus" transform="translate(200, 250)">
            <!-- Bus movement: approach, stop at red light, continue on green -->
            <animateTransform attributeName="transform" type="translate"
            values="50,250; 350,250; 350,250; 900,250"
            dur="12s"
            repeatCount="indefinite"/>
            <rect x="0" y="0" width="100" height="35" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="2"></rect>
            <rect x="95" y="3" width="10" height="29" rx="5" ry="5" fill="#FFD700" stroke="#E6C200" stroke-width="2"></rect>
            <rect x="-2" y="-3" width="104" height="5" rx="2.5" ry="2.5" fill="#FFA500"></rect>
            <!-- Windows -->
            <rect x="90" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="82" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="74" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="66" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="58" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="50" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="42" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="34" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="26" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="18" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="97" y="6" width="6" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <rect x="12" y="8" width="5" height="6" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <!-- Door and details -->
            <rect x="80" y="20" width="10" height="13" rx="1" ry="1" fill="#E6C200" stroke="#D4AF37" stroke-width="1"></rect>
            <rect x="82" y="22" width="6" height="6" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"></rect>
            <circle cx="84" cy="30" r="0.8" fill="#000"></circle>
            <text x="50" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#000">SCHOOL BUS</text>
            <rect x="0" y="18" width="100" height="3" fill="#FFA500"></rect>
            <!-- Headlight -->
            <circle cx="101" cy="12" r="2.5" fill="#FFFF00">
            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"></animate>
            </circle>
            <!-- Wheels with spinning animation -->
            <g id="front-wheel">
            <circle cx="20" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"></circle>
            <circle cx="20" cy="37" r="3" fill="#666"></circle>
            <g transform-origin="20 37">
            <line x1="20" y1="32" x2="20" y2="42" stroke="#AAA" stroke-width="1"></line>
            <line x1="15" y1="37" x2="25" y2="37" stroke="#AAA" stroke-width="1"></line>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            <g id="rear-wheel">
            <circle cx="80" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"></circle>
            <circle cx="80" cy="37" r="3" fill="#666"></circle>
            <g transform-origin="80 37">
            <line x1="80" y1="32" x2="80" y2="42" stroke="#AAA" stroke-width="1"></line>
            <line x1="75" y1="37" x2="85" y2="37" stroke="#AAA" stroke-width="1"></line>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            </g>
            <!-- Traffic light with red-yellow-green sequence -->
            <g id="traffic-light" transform="translate(450, 180)">
            <!-- Pole -->
            <rect x="18" y="70" width="4" height="80" fill="#666" stroke="#444" stroke-width="1"></rect>
            <!-- Housing -->
            <rect x="5" y="10" width="30" height="70" rx="5" ry="5" fill="#333" stroke="#222" stroke-width="2"></rect>
            <rect x="7" y="12" width="26" height="66" rx="3" ry="3" fill="#444"></rect>
            <!-- Light housings -->
            <circle cx="20" cy="25" r="8" fill="#222" stroke="#111" stroke-width="1"></circle>
            <circle cx="20" cy="40" r="8" fill="#222" stroke="#111" stroke-width="1"></circle>
            <circle cx="20" cy="55" r="8" fill="#222" stroke="#111" stroke-width="1"></circle>
            <!-- Red light (on during bus stop phase) -->
            <circle cx="20" cy="25" r="6" fill="#FF0000">
            <animate attributeName="opacity" values="1;1;1;0.3;0.3" dur="12s" repeatCount="indefinite"></animate>
            </circle>
            <!-- Yellow light (debounce transition) -->
            <circle cx="20" cy="40" r="6" fill="#FFFF00">
            <animate attributeName="opacity" values="0.3;0.3;1;1;0.3" dur="12s" repeatCount="indefinite"></animate>
            </circle>
            <circle cx="17" cy="37" r="2" fill="#FFFFFF" opacity="0.6">
            <animate attributeName="opacity" values="0.2;0.2;0.8;0.8;0.2" dur="12s" repeatCount="indefinite"></animate>
            </circle>
            <!-- Green light (on when bus continues) -->
            <circle cx="20" cy="55" r="6" fill="#00FF00">
            <animate attributeName="opacity" values="0.3;0.3;0.3;1;1" dur="12s" repeatCount="indefinite"></animate>
            </circle>
            </g>
            <!-- Billboard with manifest -->
            <g id="billboard" transform="translate(500, 120)">
            <!-- Billboard structure -->
            <rect x="0" y="0" width="120" height="80" fill="#F0F0F0" stroke="#333" stroke-width="2" rx="3"></rect>
            <rect x="2" y="2" width="116" height="76" fill="#FFFFFF" stroke="#DDD" stroke-width="1" rx="2"></rect>
            <!-- Support posts -->
            <rect x="10" y="75" width="6" height="40" fill="#8B4513"></rect>
            <rect x="104" y="75" width="6" height="40" fill="#8B4513"></rect>
            <!-- Manifest content -->
            <text x="60" y="15" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">MANIFEST</text>
            <text x="10" y="30" font-family="Courier, monospace" font-size="8" fill="#000">{</text>
            <text x="15" y="42" font-family="Courier, monospace" font-size="8" fill="#000">"topic": "bus.route",</text>
            <text x="15" y="54" font-family="Courier, monospace" font-size="8" fill="#000">"routes": ["school"],</text>
            <text x="15" y="66" font-family="Courier, monospace" font-size="8" fill="#000">"perf.debounceMs": 500</text>
            <text x="10" y="78" font-family="Courier, monospace" font-size="8" fill="#000">}</text>
            </g>
            <!-- Street sign with diagnostics -->
            <g id="street-sign" transform="translate(650, 200)">
            <!-- Sign post -->
            <rect x="18" y="40" width="4" height="60" fill="#666"></rect>
            <!-- Sign -->
            <rect x="0" y="0" width="40" height="25" fill="#228B22" stroke="#006400" stroke-width="2" rx="2"></rect>
            <rect x="2" y="2" width="36" height="21" fill="#32CD32" stroke="#228B22" stroke-width="1" rx="1"></rect>
            <!-- Sign text -->
            <text x="20" y="10" text-anchor="middle" font-family="Courier, monospace" font-size="6" font-weight="bold" fill="#FFFFFF">Logs ▶</text>
            <text x="20" y="18" text-anchor="middle" font-family="Courier, monospace" font-size="5" fill="#FFFFFF">routing_to...</text>
            </g>
            <!-- Sky Text -->
            <g id="sky-text" transform="translate(400, 40)">
            <!-- Bold headline -->
            <text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">Data drives the route.</text>
            <!-- Supporting description -->
            <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">The <tspan fill="#4A90E2">manifest</tspan> maps the path, while <tspan fill="#FFD44D">debounce</tspan> slows bursts at the light.</text>
            </g>
            <!-- Caption -->
            <g id="caption" transform="translate(400, 370)">
            <rect x="-180" y="-10" width="360" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"></rect>
            <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Manifest plans route; yellow light settles bursts (debounce)</text>
            </g>
          </g>
        </g>
      </g>
    

      <g id="scene-3" class="scene-boundary" transform="translate(50, 600)">
        <!-- Scene background -->
        <rect x="0" y="0" width="800" height="400"
              fill="#87CEEB"
              stroke="#1976D2"
              stroke-width="2"
              rx="8"
              ry="8"/>

        <!-- Scene title -->
        <text x="400" y="25" text-anchor="middle"
              class="scene-title"
              font-size="16"
              fill="#1976D2">
          Scene 3: 3 RX-NODE-SCENE3
        </text>

        <!-- Scene content with enforced clipping -->
        <g class="scene-content" clip-path="url(#scene-3-clip)">
          <g transform="translate(0, 40)">
            <!-- Scene 3: First subscriber stop and replay cache with animations -->
            <!-- Background sky -->
            <rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
            <!-- Clouds -->
            <g fill="#FFFFFF" opacity="0.8">
            <circle cx="100" cy="45" r="16"/>
            <circle cx="118" cy="45" r="11"/>
            <circle cx="88" cy="50" r="9"/>
            <circle cx="600" cy="65" r="20"/>
            <circle cx="622" cy="65" r="14"/>
            <circle cx="585" cy="70" r="11"/>
            <circle cx="350" cy="35" r="13"/>
            <circle cx="365" cy="35" r="9"/>
            <circle cx="340" cy="40" r="7"/>
            </g>
            <!-- Ground -->
            <rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
            <!-- Road -->
            <rect x="0" y="280" width="800" height="60" fill="#404040"/>
            <rect x="0" y="278" width="800" height="2" fill="#606060"/>
            <rect x="0" y="340" width="800" height="2" fill="#606060"/>
            <!-- Guardrails -->
            <rect x="0" y="265" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <rect x="0" y="345" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <!-- Dashed center line -->
            <g fill="#FFFF00">
            <rect x="50" y="308" width="40" height="4"/>
            <rect x="120" y="308" width="40" height="4"/>
            <rect x="190" y="308" width="40" height="4"/>
            <rect x="260" y="308" width="40" height="4"/>
            <rect x="330" y="308" width="40" height="4"/>
            <rect x="400" y="308" width="40" height="4"/>
            <rect x="470" y="308" width="40" height="4"/>
            <rect x="540" y="308" width="40" height="4"/>
            <rect x="610" y="308" width="40" height="4"/>
            <rect x="680" y="308" width="40" height="4"/>
            </g>
            <!-- School bus with pickup animation -->
            <g id="school-bus" transform="translate(350, 250)">
            <!-- Bus movement: approach stop, pause for pickup, continue -->
            <animateTransform attributeName="transform" type="translate"
            values="100,250; 450,250; 450,250; 900,250"
            dur="15s"
            repeatCount="indefinite"/>
            <rect x="0" y="0" width="100" height="35" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <rect x="95" y="3" width="10" height="29" rx="5" ry="5" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <rect x="-2" y="-3" width="104" height="5" rx="2.5" ry="2.5" fill="#FFA500"/>
            <!-- Windows -->
            <rect x="90" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="82" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="74" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="66" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="58" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="50" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="42" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="34" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="26" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="18" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="97" y="6" width="6" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="12" y="8" width="5" height="6" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <!-- Door with opening animation -->
            <rect x="80" y="20" width="10" height="13" rx="1" ry="1" fill="#E6C200" stroke="#D4AF37" stroke-width="1">
            <animate attributeName="width" values="10;2;10" dur="15s" repeatCount="indefinite"/>
            </rect>
            <text x="50" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#000">SCHOOL BUS</text>
            <rect x="0" y="18" width="100" height="3" fill="#FFA500"/>
            <circle cx="101" cy="12" r="2.5" fill="#FFFF00">
            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
            </circle>
            <!-- Wheels with spinning animation -->
            <g id="front-wheel">
            <circle cx="20" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
            <circle cx="20" cy="37" r="3" fill="#666"/>
            <g transform-origin="20 37">
            <line x1="20" y1="32" x2="20" y2="42" stroke="#AAA" stroke-width="1"/>
            <line x1="15" y1="37" x2="25" y2="37" stroke="#AAA" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            <g id="rear-wheel">
            <circle cx="80" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
            <circle cx="80" cy="37" r="3" fill="#666"/>
            <g transform-origin="80 37">
            <line x1="80" y1="32" x2="80" y2="42" stroke="#AAA" stroke-width="1"/>
            <line x1="75" y1="37" x2="85" y2="37" stroke="#AAA" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            </g>
            <!-- Bus stop shelter -->
            <g id="bus-stop-shelter" transform="translate(550, 180)">
            <!-- Shelter roof -->
            <rect x="0" y="0" width="120" height="8" fill="#4682B4" stroke="#2F4F4F" stroke-width="2" rx="4"/>
            <!-- Shelter supports -->
            <rect x="5" y="8" width="4" height="60" fill="#708090"/>
            <rect x="111" y="8" width="4" height="60" fill="#708090"/>
            <!-- Shelter back wall -->
            <rect x="5" y="15" width="110" height="53" fill="#E0E7FF" stroke="#3B82F6" stroke-width="1" opacity="0.8"/>
            <!-- Shelter floor -->
            <rect x="0" y="65" width="120" height="5" fill="#C0C0C0"/>
            <!-- Live Subscriber bench -->
            <rect x="15" y="45" width="40" height="15" fill="#3B82F6" stroke="#1E3A8A" stroke-width="1" rx="2"/>
            <rect x="15" y="40" width="40" height="8" fill="#60A5FA" stroke="#3B82F6" stroke-width="1" rx="1"/>
            <!-- Late Subscriber bench -->
            <rect x="65" y="45" width="40" height="15" fill="#EF4444" stroke="#DC2626" stroke-width="1" rx="2"/>
            <rect x="65" y="40" width="40" height="8" fill="#F87171" stroke="#EF4444" stroke-width="1" rx="1"/>
            <!-- Bench labels -->
            <text x="35" y="38" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" font-weight="bold" fill="#1E3A8A">Live Subscriber</text>
            <text x="85" y="38" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" font-weight="bold" fill="#DC2626">Late Subscriber</text>
            <!-- Live subscriber with boarding animation -->
            <g id="live-subscriber" transform="translate(25, 25)">
            <circle cx="5" cy="5" r="3" fill="#FBBF24"/>
            <rect x="2" y="8" width="6" height="10" fill="#3B82F6" rx="1"/>
            <rect x="1" y="12" width="2" height="6" fill="#1E3A8A"/>
            <rect x="7" y="12" width="2" height="6" fill="#1E3A8A"/>
            <!-- Animation: subscriber moves toward bus during pickup -->
            <animateTransform attributeName="transform" type="translate"
            values="25,25; 25,25; -100,50; -100,50"
            dur="15s"
            repeatCount="indefinite"/>
            <!-- Opacity animation: subscriber disappears when boarding bus -->
            <animate attributeName="opacity"
            values="1;1;0;0"
            dur="15s"
            repeatCount="indefinite"/>
            </g>
            <!-- Late subscriber with waiting animation -->
            <g id="late-subscriber" transform="translate(75, 25)">
            <circle cx="5" cy="5" r="3" fill="#F87171"/>
            <rect x="2" y="8" width="6" height="10" fill="#EF4444" rx="1"/>
            <rect x="1" y="12" width="2" height="6" fill="#DC2626"/>
            <rect x="7" y="12" width="2" height="6" fill="#DC2626"/>
            <!-- Animation: late subscriber stays and fades (missed the bus) -->
            <animate attributeName="opacity" values="1;1;1;0.3;0.3" dur="15s" repeatCount="indefinite"/>
            </g>
            </g>
            <!-- Replay Cache kiosk -->
            <g id="replay-cache-kiosk" transform="translate(680, 200)">
            <!-- Kiosk structure -->
            <rect x="0" y="0" width="60" height="70" fill="#6B7280" stroke="#374151" stroke-width="2" rx="4"/>
            <rect x="3" y="3" width="54" height="64" fill="#9CA3AF" stroke="#6B7280" stroke-width="1" rx="3"/>
            <!-- Kiosk screen/window -->
            <rect x="8" y="15" width="44" height="30" fill="#1F2937" stroke="#111827" stroke-width="1" rx="2"/>
            <rect x="10" y="17" width="40" height="26" fill="#374151" stroke="#1F2937" stroke-width="1" rx="1"/>
            <!-- Cache content display -->
            <text x="30" y="27" text-anchor="middle" font-family="Courier, monospace" font-size="6" fill="#10B981">REPLAY CACHE</text>
            <text x="30" y="35" text-anchor="middle" font-family="Courier, monospace" font-size="5" fill="#FFFFFF">Last Message:</text>
            <text x="30" y="41" text-anchor="middle" font-family="Courier, monospace" font-size="4" fill="#FBBF24">{payload: "..."}</text>
            <!-- Kiosk label -->
            <rect x="5" y="50" width="50" height="12" fill="#FFFFFF" stroke="#333" stroke-width="1" rx="2"/>
            <text x="30" y="58" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#333">REPLAY CACHE</text>
            <!-- Activity indicator with enhanced animation -->
            <circle cx="52" cy="10" r="3" fill="#10B981">
            <animate attributeName="opacity" values="0.5;1;0.5" dur="1.5s" repeatCount="indefinite"/>
            </circle>
            <!-- Data flow animation to late subscriber -->
            <g id="cache-data-flow">
            <circle cx="30" cy="30" r="2" fill="#FBBF24">
            <animate attributeName="opacity" values="0;1;0" dur="3s" repeatCount="indefinite"/>
            <animateTransform attributeName="transform" type="translate"
            values="0,0; -50,-20; -100,-40"
            dur="3s"
            repeatCount="indefinite"/>
            </circle>
            </g>
            </g>
            <!-- Flow arrows -->
            <g stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)">
            <!-- Bus to live subscriber -->
            <path d="M 420,280 Q 480,260 570,220" stroke="#3B82F6"/>
            <!-- Replay cache to late subscriber -->
            <path d="M 680,235 Q 650,225 620,220" stroke="#EF4444"/>
            </g>
            <!-- Arrow marker definition -->
            <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
            </marker>
            </defs>
            <!-- Sky Text -->
            <g id="sky-text" transform="translate(400, 40)">
            <!-- Bold headline -->
            <text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">No one misses the bus.</text>
            <!-- Supporting description -->
            <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">Live and late subscribers both get the message, thanks to the Replay Cache.</text>
            </g>
            <!-- Caption -->
            <g id="caption" transform="translate(400, 370)">
            <rect x="-200" y="-10" width="400" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
            <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">First stop: live &amp; late subscribers; Replay Cache hydrates latecomers</text>
            </g>
          </g>
        </g>
      </g>
    

      <g id="scene-4" class="scene-boundary" transform="translate(900, 600)">
        <!-- Scene background -->
        <rect x="0" y="0" width="800" height="400"
              fill="#87CEEB"
              stroke="#1976D2"
              stroke-width="2"
              rx="8"
              ry="8"/>

        <!-- Scene title -->
        <text x="400" y="25" text-anchor="middle"
              class="scene-title"
              font-size="16"
              fill="#1976D2">
          Scene 4: 4 RX-NODE-SCENE4
        </text>

        <!-- Scene content with enforced clipping -->
        <g class="scene-content" clip-path="url(#scene-4-clip)">
          <g transform="translate(0, 40)">
            <!-- Scene 4: Transfer hub and conductor with ramp animation -->
            <!-- Background sky -->
            <rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
            <!-- Clouds -->
            <g fill="#FFFFFF" opacity="0.8">
            <circle cx="90" cy="40" r="15"/>
            <circle cx="106" cy="40" r="10"/>
            <circle cx="80" cy="45" r="8"/>
            <circle cx="650" cy="60" r="18"/>
            <circle cx="670" cy="60" r="13"/>
            <circle cx="635" cy="65" r="10"/>
            <circle cx="300" cy="30" r="12"/>
            <circle cx="313" cy="30" r="8"/>
            <circle cx="290" cy="35" r="6"/>
            </g>
            <!-- Ground -->
            <rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
            <!-- Main road -->
            <rect x="0" y="280" width="800" height="60" fill="#404040"/>
            <rect x="0" y="278" width="800" height="2" fill="#606060"/>
            <rect x="0" y="340" width="800" height="2" fill="#606060"/>
            <!-- Conductor ramp (curved path leading up to hub) -->
            <g id="conductor-ramp">
            <!-- Ramp surface -->
            <path d="M 350,310 Q 400,280 450,260 Q 500,240 550,220 Q 600,200 650,180"
            fill="none" stroke="#606060" stroke-width="40" stroke-linecap="round"/>
            <path d="M 350,310 Q 400,280 450,260 Q 500,240 550,220 Q 600,200 650,180"
            fill="none" stroke="#404040" stroke-width="36" stroke-linecap="round"/>
            <!-- Ramp guardrails -->
            <path d="M 350,290 Q 400,260 450,240 Q 500,220 550,200 Q 600,180 650,160"
            fill="none" stroke="#E0E0E0" stroke-width="4" stroke-linecap="round"/>
            <path d="M 350,330 Q 400,300 450,280 Q 500,260 550,240 Q 600,220 650,200"
            fill="none" stroke="#E0E0E0" stroke-width="4" stroke-linecap="round"/>
            <!-- Ramp center line -->
            <g fill="#FFFF00">
            <ellipse cx="370" cy="305" rx="8" ry="2" transform="rotate(-10 370 305)"/>
            <ellipse cx="400" cy="290" rx="8" ry="2" transform="rotate(-15 400 290)"/>
            <ellipse cx="430" cy="275" rx="8" ry="2" transform="rotate(-20 430 275)"/>
            <ellipse cx="460" cy="258" rx="8" ry="2" transform="rotate(-25 460 258)"/>
            <ellipse cx="490" cy="240" rx="8" ry="2" transform="rotate(-30 490 240)"/>
            <ellipse cx="520" cy="222" rx="8" ry="2" transform="rotate(-35 520 222)"/>
            <ellipse cx="550" cy="203" rx="8" ry="2" transform="rotate(-40 550 203)"/>
            <ellipse cx="580" cy="185" rx="8" ry="2" transform="rotate(-45 580 185)"/>
            </g>
            </g>
            <!-- Branching roads -->
            <!-- Upper branch -->
            <polygon points="450,280 550,200 570,210 460,290" fill="#404040"/>
            <polygon points="450,278 550,198 570,208 460,288" fill="#606060"/>
            <!-- Lower branch -->
            <polygon points="450,340 550,380 570,370 460,330" fill="#404040"/>
            <polygon points="450,342 550,382 570,372 460,332" fill="#606060"/>
            <!-- Straight continuation -->
            <rect x="500" y="280" width="300" height="60" fill="#404040"/>
            <rect x="500" y="278" width="300" height="2" fill="#606060"/>
            <rect x="500" y="340" width="300" height="2" fill="#606060"/>
            <!-- Guardrails on main road -->
            <rect x="0" y="265" width="350" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <rect x="0" y="345" width="350" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <!-- Guardrails on continuation -->
            <rect x="500" y="265" width="300" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <rect x="500" y="345" width="300" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <!-- Dashed center lines -->
            <g fill="#FFFF00">
            <!-- Main road -->
            <rect x="50" y="308" width="40" height="4"/>
            <rect x="120" y="308" width="40" height="4"/>
            <rect x="190" y="308" width="40" height="4"/>
            <rect x="260" y="308" width="40" height="4"/>
            <!-- Continuation -->
            <rect x="520" y="308" width="40" height="4"/>
            <rect x="590" y="308" width="40" height="4"/>
            <rect x="660" y="308" width="40" height="4"/>
            <rect x="730" y="308" width="40" height="4"/>
            <!-- Branch roads -->
            <rect x="480" y="240" width="20" height="3" transform="rotate(-25 490 241.5)"/>
            <rect x="510" y="220" width="20" height="3" transform="rotate(-25 520 221.5)"/>
            <rect x="480" y="360" width="20" height="3" transform="rotate(25 490 361.5)"/>
            <rect x="510" y="380" width="20" height="3" transform="rotate(25 520 381.5)"/>
            </g>
            <!-- Transfer hub (circular) -->
            <g id="transfer-hub" transform="translate(450, 310)">
            <!-- Hub platform -->
            <circle cx="0" cy="0" r="50" fill="#B0C4DE" stroke="#708090" stroke-width="3"/>
            <circle cx="0" cy="0" r="47" fill="#D3D3D3" stroke="#A9A9A9" stroke-width="1"/>
            <!-- Hub center -->
            <circle cx="0" cy="0" r="25" fill="#4682B4" stroke="#2F4F4F" stroke-width="2"/>
            <circle cx="0" cy="0" r="22" fill="#5F9EA0" stroke="#4682B4" stroke-width="1"/>
            <!-- Conductor's baton and musical note -->
            <g id="conductor-icon">
            <!-- Baton -->
            <line x1="-8" y1="8" x2="8" y2="-8" stroke="#FFFFFF" stroke-width="3" stroke-linecap="round"/>
            <circle cx="8" cy="-8" r="2" fill="#FFFFFF"/>
            <circle cx="-8" cy="8" r="1.5" fill="#FFFFFF"/>
            <!-- Musical note -->
            <circle cx="5" cy="5" r="3" fill="#FFD700" stroke="#FFA500" stroke-width="1"/>
            <rect x="7.5" y="-5" width="1.5" height="10" fill="#FFD700"/>
            <path d="M 9,0 Q 12,-2 12,2" stroke="#FFD700" stroke-width="1.5" fill="none"/>
            </g>
            <!-- Hub label -->
            <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1E3A8A">Conductor: play()</text>
            </g>
            <!-- School bus with ramp flying animation -->
            <g id="school-bus" transform="translate(300, 250)">
            <!-- Bus movement: approach ramp, drive up ramp, fly off into sky -->
            <animateTransform attributeName="transform" type="translate"
            values="100,250; 350,310; 450,260; 550,220; 650,180; 750,140; 900,100"
            dur="18s"
            repeatCount="indefinite"/>
            <!-- Bus rotation during ramp ascent -->
            <g transform-origin="50 17.5">
            <animateTransform attributeName="transform" type="rotate"
            values="0; 0; -10; -20; -30; -40; -45"
            dur="18s"
            repeatCount="indefinite"/>
            <rect x="0" y="0" width="100" height="35" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <rect x="95" y="3" width="10" height="29" rx="5" ry="5" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <rect x="-2" y="-3" width="104" height="5" rx="2.5" ry="2.5" fill="#FFA500"/>
            <!-- Windows -->
            <rect x="90" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="82" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="74" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="66" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="58" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="50" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="42" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="34" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="26" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="18" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="97" y="6" width="6" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="12" y="8" width="5" height="6" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="80" y="20" width="10" height="13" rx="1" ry="1" fill="#E6C200" stroke="#D4AF37" stroke-width="1"/>
            <text x="50" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#000">SCHOOL BUS</text>
            <rect x="0" y="18" width="100" height="3" fill="#FFA500"/>
            <circle cx="101" cy="12" r="2.5" fill="#FFFF00">
            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
            </circle>
            <!-- Wheels with spinning animation -->
            <g id="front-wheel">
            <circle cx="20" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
            <circle cx="20" cy="37" r="3" fill="#666"/>
            <g transform-origin="20 37">
            <line x1="20" y1="32" x2="20" y2="42" stroke="#AAA" stroke-width="1"/>
            <line x1="15" y1="37" x2="25" y2="37" stroke="#AAA" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            <g id="rear-wheel">
            <circle cx="80" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
            <circle cx="80" cy="37" r="3" fill="#666"/>
            <g transform-origin="80 37">
            <line x1="80" y1="32" x2="80" y2="42" stroke="#AAA" stroke-width="1"/>
            <line x1="75" y1="37" x2="85" y2="37" stroke="#AAA" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            </g>
            </g>
            <!-- Other buses at hub -->
            <!-- Upper branch bus -->
            <g id="upper-bus" transform="translate(520, 180) rotate(-25)">
            <!-- Green bus animation: drives off ramp and off the page -->
            <animateTransform attributeName="transform" type="translate"
            values="520,180; 600,160; 700,140; 850,120; 950,100"
            dur="20s"
            repeatCount="indefinite"/>
            <rect x="0" y="0" width="60" height="25" rx="3" ry="3" fill="#32CD32" stroke="#228B22" stroke-width="1"/>
            <rect x="55" y="2" width="8" height="21" rx="4" ry="4" fill="#32CD32" stroke="#228B22" stroke-width="1"/>
            <rect x="52" y="4" width="5" height="8" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="45" y="4" width="5" height="8" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="38" y="4" width="5" height="8" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <circle cx="15" cy="27" r="4" fill="#333"/>
            <circle cx="45" cy="27" r="4" fill="#333"/>
            <text x="30" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" fill="#000">PLUGIN A</text>
            </g>
            <!-- Lower branch bus -->
            <g id="lower-bus" transform="translate(520, 360) rotate(25)">
            <rect x="0" y="0" width="60" height="25" rx="3" ry="3" fill="#FF6347" stroke="#DC143C" stroke-width="1"/>
            <rect x="55" y="2" width="8" height="21" rx="4" ry="4" fill="#FF6347" stroke="#DC143C" stroke-width="1"/>
            <rect x="52" y="4" width="5" height="8" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="45" y="4" width="5" height="8" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="38" y="4" width="5" height="8" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <circle cx="15" cy="27" r="4" fill="#333"/>
            <circle cx="45" cy="27" r="4" fill="#333"/>
            <text x="30" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" fill="#000">PLUGIN B</text>
            </g>
            <!-- Passengers transferring -->
            <g id="transferring-passengers">
            <!-- Passenger 1 - walking to upper bus -->
            <g transform="translate(470, 270)">
            <circle cx="0" cy="0" r="2" fill="#FBBF24"/>
            <rect x="-1" y="2" width="2" height="6" fill="#3B82F6" rx="0.5"/>
            <rect x="-1.5" y="4" width="1" height="4" fill="#1E3A8A"/>
            <rect x="0.5" y="4" width="1" height="4" fill="#1E3A8A"/>
            </g>
            <!-- Passenger 2 - walking to lower bus -->
            <g transform="translate(460, 330)">
            <circle cx="0" cy="0" r="2" fill="#F87171"/>
            <rect x="-1" y="2" width="2" height="6" fill="#EF4444" rx="0.5"/>
            <rect x="-1.5" y="4" width="1" height="4" fill="#DC2626"/>
            <rect x="0.5" y="4" width="1" height="4" fill="#DC2626"/>
            </g>
            <!-- Passenger 3 - at hub -->
            <g transform="translate(440, 300)">
            <circle cx="0" cy="0" r="2" fill="#34D399"/>
            <rect x="-1" y="2" width="2" height="6" fill="#10B981" rx="0.5"/>
            <rect x="-1.5" y="4" width="1" height="4" fill="#059669"/>
            <rect x="0.5" y="4" width="1" height="4" fill="#059669"/>
            </g>
            </g>
            <!-- Direction arrows -->
            <g stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)">
            <path d="M 420,290 Q 440,280 460,270" stroke="#32CD32"/>
            <path d="M 420,320 Q 440,330 460,340" stroke="#FF6347"/>
            <path d="M 500,310 L 580,310" stroke="#FFD700"/>
            </g>
            <!-- Arrow marker definition -->
            <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
            </marker>
            </defs>
            <!-- Sky Text -->
            <g id="sky-text" transform="translate(400, 40)">
            <!-- Bold headline -->
            <text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">The <tspan fill="#6B4EFF">Conductor</tspan> orchestrates the flow.</text>
            <!-- Supporting description -->
            <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">At the hub, events branch into sequences and plugins.</text>
            </g>
            <!-- Caption -->
            <g id="caption" transform="translate(400, 370)">
            <rect x="-220" y="-10" width="440" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
            <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Special hub: topics route into sequences via Conductor (plugins)</text>
            </g>
          </g>
        </g>
      </g>
    

      <g id="scene-5" class="scene-boundary" transform="translate(50, 1050)">
        <!-- Scene background -->
        <rect x="0" y="0" width="800" height="400"
              fill="#87CEEB"
              stroke="#1976D2"
              stroke-width="2"
              rx="8"
              ry="8"/>

        <!-- Scene title -->
        <text x="400" y="25" text-anchor="middle"
              class="scene-title"
              font-size="16"
              fill="#1976D2">
          Scene 5: 5 RX-NODE-SCENE5
        </text>

        <!-- Scene content with enforced clipping -->
        <g class="scene-content" clip-path="url(#scene-5-clip)">
          <g transform="translate(0, 40)">
            <!-- Scene 5: Rules, boundaries, and street signs with traffic light animation -->
            <!-- Background sky -->
            <rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
            <!-- Clouds -->
            <g fill="#FFFFFF" opacity="0.8">
            <circle cx="80" cy="35" r="14"/>
            <circle cx="95" cy="35" r="9"/>
            <circle cx="70" cy="40" r="7"/>
            <circle cx="600" cy="55" r="16"/>
            <circle cx="618" cy="55" r="11"/>
            <circle cx="588" cy="60" r="9"/>
            <circle cx="250" cy="25" r="11"/>
            <circle cx="262" cy="25" r="7"/>
            <circle cx="242" cy="30" r="5"/>
            </g>
            <!-- Ground -->
            <rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
            <!-- Road -->
            <rect x="0" y="280" width="800" height="60" fill="#404040"/>
            <rect x="0" y="278" width="800" height="2" fill="#606060"/>
            <rect x="0" y="340" width="800" height="2" fill="#606060"/>
            <!-- Enhanced guardrails -->
            <rect x="0" y="265" width="800" height="10" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <rect x="0" y="345" width="800" height="10" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <!-- Guardrail posts -->
            <g fill="#C0C0C0">
            <rect x="50" y="260" width="4" height="20"/>
            <rect x="150" y="260" width="4" height="20"/>
            <rect x="250" y="260" width="4" height="20"/>
            <rect x="350" y="260" width="4" height="20"/>
            <rect x="450" y="260" width="4" height="20"/>
            <rect x="550" y="260" width="4" height="20"/>
            <rect x="650" y="260" width="4" height="20"/>
            <rect x="750" y="260" width="4" height="20"/>
            <rect x="50" y="345" width="4" height="20"/>
            <rect x="150" y="345" width="4" height="20"/>
            <rect x="250" y="345" width="4" height="20"/>
            <rect x="350" y="345" width="4" height="20"/>
            <rect x="450" y="345" width="4" height="20"/>
            <rect x="550" y="345" width="4" height="20"/>
            <rect x="650" y="345" width="4" height="20"/>
            <rect x="750" y="345" width="4" height="20"/>
            </g>
            <!-- Lane markings for performance controls -->
            <!-- Debounce lane (left) - funnel with single pulse -->
            <g transform="translate(200, 290)">
            <!-- Funnel shape -->
            <polygon points="0,10 20,5 20,15 0,20" fill="#FFFF00" opacity="0.7"/>
            <polygon points="25,7 35,8 35,12 25,13" fill="#FFFF00" opacity="0.7"/>
            <!-- Single pulse after funnel -->
            <rect x="40" y="8" width="8" height="4" fill="#FFFF00" rx="2"/>
            </g>
            <!-- Throttle lane (right) - evenly spaced ticks -->
            <g transform="translate(500, 295)" fill="#FFFF00" opacity="0.7">
            <rect x="0" y="0" width="3" height="10" rx="1"/>
            <rect x="10" y="0" width="3" height="10" rx="1"/>
            <rect x="20" y="0" width="3" height="10" rx="1"/>
            <rect x="30" y="0" width="3" height="10" rx="1"/>
            <rect x="40" y="0" width="3" height="10" rx="1"/>
            <rect x="50" y="0" width="3" height="10" rx="1"/>
            </g>
            <!-- Regular dashed center line -->
            <g fill="#FFFF00">
            <rect x="50" y="308" width="30" height="4"/>
            <rect x="120" y="308" width="30" height="4"/>
            <rect x="300" y="308" width="30" height="4"/>
            <rect x="370" y="308" width="30" height="4"/>
            <rect x="600" y="308" width="30" height="4"/>
            <rect x="680" y="308" width="30" height="4"/>
            <rect x="750" y="308" width="30" height="4"/>
            </g>
            <!-- School bus with traffic light stop-and-go animation -->
            <g id="school-bus" transform="translate(350, 250)">
            <!-- Bus movement: approach traffic light, stop at red, proceed on green -->
            <animateTransform attributeName="transform" type="translate"
            values="100,250; 600,250; 600,250; 900,250"
            dur="16s"
            repeatCount="indefinite"/>
            <rect x="0" y="0" width="100" height="35" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <rect x="95" y="3" width="10" height="29" rx="5" ry="5" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <rect x="-2" y="-3" width="104" height="5" rx="2.5" ry="2.5" fill="#FFA500"/>
            <!-- Windows -->
            <rect x="90" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="82" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="74" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="66" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="58" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="50" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="42" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="34" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="26" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="18" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="97" y="6" width="6" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="12" y="8" width="5" height="6" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="80" y="20" width="10" height="13" rx="1" ry="1" fill="#E6C200" stroke="#D4AF37" stroke-width="1"/>
            <text x="50" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#000">SCHOOL BUS</text>
            <rect x="0" y="18" width="100" height="3" fill="#FFA500"/>
            <circle cx="101" cy="12" r="2.5" fill="#FFFF00">
            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
            </circle>
            <!-- Wheels with spinning animation -->
            <g id="front-wheel">
            <circle cx="20" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
            <circle cx="20" cy="37" r="3" fill="#666"/>
            <g transform-origin="20 37">
            <line x1="20" y1="32" x2="20" y2="42" stroke="#AAA" stroke-width="1"/>
            <line x1="15" y1="37" x2="25" y2="37" stroke="#AAA" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            <g id="rear-wheel">
            <circle cx="80" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
            <circle cx="80" cy="37" r="3" fill="#666"/>
            <g transform-origin="80 37">
            <line x1="80" y1="32" x2="80" y2="42" stroke="#AAA" stroke-width="1"/>
            <line x1="75" y1="37" x2="85" y2="37" stroke="#AAA" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            </g>
            <!-- Street signs for rules and boundaries -->
            <!-- Loop Prevention sign -->
            <g id="loop-prevention-sign" transform="translate(100, 180)">
            <rect x="18" y="40" width="4" height="50" fill="#666"/>
            <polygon points="0,0 40,0 35,35 5,35" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <polygon points="2,2 38,2 33,33 7,33" fill="#FFF8DC"/>
            <!-- Loop symbol crossed out -->
            <circle cx="20" cy="18" r="8" fill="none" stroke="#DC143C" stroke-width="2"/>
            <path d="M 15,13 Q 20,8 25,13 Q 20,18 15,13" fill="none" stroke="#DC143C" stroke-width="2"/>
            <line x1="12" y1="12" x2="28" y2="24" stroke="#DC143C" stroke-width="3"/>
            <text x="20" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#DC143C">LOOP</text>
            <text x="20" y="36" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#DC143C">PREVENTION</text>
            </g>
            <!-- Handler Isolation sign -->
            <g id="handler-isolation-sign" transform="translate(300, 170)">
            <rect x="18" y="50" width="4" height="60" fill="#666"/>
            <rect x="0" y="0" width="40" height="35" fill="#228B22" stroke="#006400" stroke-width="2" rx="3"/>
            <rect x="2" y="2" width="36" height="31" fill="#32CD32" rx="2"/>
            <!-- Lab flask icon -->
            <g transform="translate(20, 18)">
            <rect x="-3" y="-8" width="6" height="4" fill="#FFFFFF" rx="1"/>
            <polygon points="-5,0 5,0 3,8 -3,8" fill="#FFFFFF"/>
            <circle cx="0" cy="4" r="2" fill="#00BFFF"/>
            <rect x="-1" y="-6" width="2" height="2" fill="#FFFFFF"/>
            </g>
            <text x="20" y="28" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" font-weight="bold" fill="#FFFFFF">HANDLER</text>
            <text x="20" y="33" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" font-weight="bold" fill="#FFFFFF">ISOLATION</text>
            </g>
            <!-- Feature Flags sign -->
            <g id="feature-flags-sign" transform="translate(600, 175)">
            <rect x="18" y="45" width="4" height="55" fill="#666"/>
            <rect x="0" y="0" width="40" height="30" fill="#4169E1" stroke="#191970" stroke-width="2" rx="3"/>
            <rect x="2" y="2" width="36" height="26" fill="#6495ED" rx="2"/>
            <!-- Toggle switch -->
            <rect x="10" y="8" width="20" height="8" fill="#FFFFFF" stroke="#333" stroke-width="1" rx="4"/>
            <circle cx="25" cy="12" r="3" fill="#32CD32" stroke="#228B22" stroke-width="1"/>
            <text x="8" y="14" font-family="Arial, sans-serif" font-size="4" fill="#333">OFF</text>
            <text x="28" y="14" font-family="Arial, sans-serif" font-size="4" fill="#333">ON</text>
            <text x="20" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" font-weight="bold" fill="#FFFFFF">FEATURE</text>
            <text x="20" y="29" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" font-weight="bold" fill="#FFFFFF">FLAGS</text>
            </g>
            <!-- Traffic light with synchronized sequence -->
            <g id="traffic-light" transform="translate(720, 190)">
            <rect x="18" y="50" width="3" height="40" fill="#666"/>
            <rect x="10" y="10" width="20" height="45" rx="3" ry="3" fill="#333"/>
            <!-- Red light (active during bus stop period) -->
            <circle cx="20" cy="20" r="4" fill="#FF0000">
            <animate attributeName="fill" values="#800000;#FF0000;#800000;#800000" dur="16s" repeatCount="indefinite"/>
            </circle>
            <!-- Yellow light (brief transition) -->
            <circle cx="20" cy="30" r="4" fill="#806000">
            <animate attributeName="fill" values="#806000;#806000;#FFFF00;#806000" dur="16s" repeatCount="indefinite"/>
            </circle>
            <!-- Green light (active during bus movement) -->
            <circle cx="20" cy="40" r="4" fill="#008000">
            <animate attributeName="fill" values="#008000;#008000;#008000;#00FF00" dur="16s" repeatCount="indefinite"/>
            </circle>
            </g>
            <!-- Sky Text -->
            <g id="sky-text" transform="translate(400, 40)">
            <!-- Bold headline -->
            <text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">Rules keep the ride safe.</text>
            <!-- Supporting description -->
            <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">Guardrails, flags, <tspan fill="#228B22">throttle</tspan>, and <tspan fill="#FFD44D">debounce</tspan> enforce stability.</text>
            </g>
            <!-- Caption -->
            <g id="caption" transform="translate(400, 370)">
            <rect x="-250" y="-10" width="500" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
            <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Street rules: enforced boundaries, flags, throttle &amp; debounce lanes</text>
            </g>
          </g>
        </g>
      </g>
    

      <g id="scene-6" class="scene-boundary" transform="translate(900, 1050)">
        <!-- Scene background -->
        <rect x="0" y="0" width="800" height="400"
              fill="#87CEEB"
              stroke="#1976D2"
              stroke-width="2"
              rx="8"
              ry="8"/>

        <!-- Scene title -->
        <text x="400" y="25" text-anchor="middle"
              class="scene-title"
              font-size="16"
              fill="#1976D2">
          Scene 6: 6 RX-NODE-SCENE6
        </text>

        <!-- Scene content with enforced clipping -->
        <g class="scene-content" clip-path="url(#scene-6-clip)">
          <g transform="translate(0, 40)">
            <!-- Scene 6: Final destination - the school with animated bus arrival and children jumping -->
            <!-- Background sky -->
            <rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
            <!-- Clouds -->
            <g fill="#FFFFFF" opacity="0.8">
            <circle cx="70" cy="30" r="13"/>
            <circle cx="84" cy="30" r="8"/>
            <circle cx="60" cy="35" r="6"/>
            <circle cx="650" cy="50" r="15"/>
            <circle cx="667" cy="50" r="10"/>
            <circle cx="638" cy="55" r="8"/>
            <circle cx="200" cy="20" r="10"/>
            <circle cx="211" cy="20" r="6"/>
            <circle cx="192" cy="25" r="4"/>
            </g>
            <!-- Ground -->
            <rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
            <!-- Road ending at school -->
            <rect x="0" y="280" width="400" height="60" fill="#404040"/>
            <rect x="0" y="278" width="400" height="2" fill="#606060"/>
            <rect x="0" y="340" width="400" height="2" fill="#606060"/>
            <!-- School courtyard/parking area -->
            <rect x="400" y="280" width="400" height="60" fill="#C0C0C0"/>
            <rect x="398" y="278" width="4" height="64" fill="#606060"/>
            <!-- Guardrails ending -->
            <rect x="0" y="265" width="400" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <rect x="0" y="345" width="400" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
            <!-- Dashed center line ending -->
            <g fill="#FFFF00">
            <rect x="50" y="308" width="30" height="4"/>
            <rect x="120" y="308" width="30" height="4"/>
            <rect x="190" y="308" width="30" height="4"/>
            <rect x="260" y="308" width="30" height="4"/>
            <rect x="330" y="308" width="30" height="4"/>
            </g>
            <!-- School building -->
            <g id="school-building" transform="translate(500, 100)">
            <!-- Main building -->
            <rect x="0" y="50" width="200" height="120" fill="#CD853F" stroke="#8B4513" stroke-width="2"/>
            <!-- Roof -->
            <polygon points="-10,50 100,10 210,50" fill="#8B0000" stroke="#654321" stroke-width="2"/>
            <!-- Roof ridge -->
            <line x1="100" y1="10" x2="100" y2="50" stroke="#654321" stroke-width="1"/>
            <!-- School entrance -->
            <rect x="85" y="120" width="30" height="50" fill="#4682B4" stroke="#2F4F4F" stroke-width="2" rx="15" ry="0"/>
            <rect x="87" y="122" width="26" height="25" fill="#87CEEB" stroke="#4682B4" stroke-width="1" rx="13" ry="0"/>
            <!-- Door handle -->
            <circle cx="110" cy="145" r="2" fill="#FFD700"/>
            <!-- Windows -->
            <rect x="20" y="70" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
            <rect x="50" y="70" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
            <rect x="130" y="70" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
            <rect x="160" y="70" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
            <rect x="20" y="100" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
            <rect x="50" y="100" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
            <rect x="130" y="100" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
            <rect x="160" y="100" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
            <!-- Window frames -->
            <g stroke="#2F4F4F" stroke-width="0.5">
            <line x1="30" y1="70" x2="30" y2="90"/>
            <line x1="20" y1="80" x2="40" y2="80"/>
            <line x1="60" y1="70" x2="60" y2="90"/>
            <line x1="50" y1="80" x2="70" y2="80"/>
            <line x1="140" y1="70" x2="140" y2="90"/>
            <line x1="130" y1="80" x2="150" y2="80"/>
            <line x1="170" y1="70" x2="170" y2="90"/>
            <line x1="160" y1="80" x2="180" y2="80"/>
            <line x1="30" y1="100" x2="30" y2="120"/>
            <line x1="20" y1="110" x2="40" y2="110"/>
            <line x1="60" y1="100" x2="60" y2="120"/>
            <line x1="50" y1="110" x2="70" y2="110"/>
            <line x1="140" y1="100" x2="140" y2="120"/>
            <line x1="130" y1="110" x2="150" y2="110"/>
            <line x1="170" y1="100" x2="170" y2="120"/>
            <line x1="160" y1="110" x2="180" y2="110"/>
            </g>
            <!-- Flagpole -->
            <rect x="98" y="0" width="4" height="60" fill="#8B4513"/>
            <!-- Flag -->
            <rect x="102" y="5" width="30" height="20" fill="#FF0000">
            <animate attributeName="d" values="M102,5 L132,5 L132,25 L102,25 Z;M102,5 L132,7 L132,23 L102,25 Z;M102,5 L132,5 L132,25 L102,25 Z" dur="2s" repeatCount="indefinite"/>
            </rect>
            <polygon points="102,5 132,7 132,23 102,25" fill="#FF0000">
            <animateTransform attributeName="transform" type="skewX" values="0;3;0" dur="2s" repeatCount="indefinite"/>
            </polygon>
            <!-- School sign -->
            <rect x="60" y="130" width="80" height="15" fill="#FFFFFF" stroke="#333" stroke-width="1" rx="2"/>
            <text x="100" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">ELEMENTARY SCHOOL</text>
            </g>
            <!-- School bus with arrival animation -->
            <g id="school-bus" transform="translate(250, 250)">
            <!-- Bus movement: approach school stop and park -->
            <animateTransform attributeName="transform" type="translate"
            values="100,250; 250,250; 250,250"
            dur="12s"
            repeatCount="indefinite"/>
            <rect x="0" y="0" width="120" height="35" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <rect x="115" y="3" width="12" height="29" rx="6" ry="6" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
            <rect x="-2" y="-3" width="124" height="5" rx="2.5" ry="2.5" fill="#FFA500"/>
            <!-- Windows -->
            <rect x="110" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="100" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="90" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="80" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="70" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="60" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="50" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="40" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="30" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="20" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="10" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="117" y="6" width="8" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="5" y="8" width="6" height="6" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
            <rect x="95" y="20" width="12" height="13" rx="1" ry="1" fill="#E6C200" stroke="#D4AF37" stroke-width="1"/>
            <text x="60" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" font-weight="bold" fill="#000">SCHOOL BUS</text>
            <rect x="0" y="18" width="120" height="3" fill="#FFA500"/>
            <!-- Headlight (glowing when moving) -->
            <circle cx="123" cy="12" r="2.5" fill="#FFFF00">
            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
            </circle>
            <!-- Wheels with spinning animation -->
            <g id="front-wheel">
            <circle cx="25" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
            <circle cx="25" cy="37" r="3" fill="#666"/>
            <g transform-origin="25 37">
            <line x1="25" y1="32" x2="25" y2="42" stroke="#AAA" stroke-width="1"/>
            <line x1="20" y1="37" x2="30" y2="37" stroke="#AAA" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            <g id="rear-wheel">
            <circle cx="95" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
            <circle cx="95" cy="37" r="3" fill="#666"/>
            <g transform-origin="95 37">
            <line x1="95" y1="32" x2="95" y2="42" stroke="#AAA" stroke-width="1"/>
            <line x1="90" y1="37" x2="100" y2="37" stroke="#AAA" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
            </g>
            </g>
            <!-- Door animation (opens when parked) -->
            <g id="bus-door">
            <rect x="95" y="20" width="12" height="13" fill="none" stroke="#D4AF37" stroke-width="1"/>
            <rect x="107" y="22" width="8" height="9" fill="#E6C200" stroke="#D4AF37" stroke-width="1">
            <animateTransform attributeName="transform" type="translate"
            values="0,0; 0,0; 15,0"
            dur="12s"
            repeatCount="indefinite"/>
            </rect>
            </g>
            </g>
            <!-- Children with jumping and boarding animations -->
            <g id="children-jumping">
            <!-- Child 1 - jumping off bus -->
            <g transform="translate(380, 270)">
            <animateTransform attributeName="transform" type="translate"
            values="380,270; 380,270; 380,265; 380,270; 420,275"
            dur="12s"
            repeatCount="indefinite"/>
            <circle cx="0" cy="0" r="3" fill="#FBBF24"/>
            <rect x="-2" y="3" width="4" height="8" fill="#3B82F6" rx="1"/>
            <rect x="-2.5" y="6" width="2" height="5" fill="#1E3A8A"/>
            <rect x="0.5" y="6" width="2" height="5" fill="#1E3A8A"/>
            <!-- Backpack -->
            <rect x="2" y="4" width="2" height="4" fill="#DC2626" rx="1"/>
            </g>
            <!-- Child 2 - jumping and walking toward school -->
            <g transform="translate(420, 275)">
            <animateTransform attributeName="transform" type="translate"
            values="420,275; 420,275; 420,270; 420,275; 480,280"
            dur="12s"
            repeatCount="indefinite"/>
            <circle cx="0" cy="0" r="3" fill="#F87171"/>
            <rect x="-2" y="3" width="4" height="8" fill="#10B981" rx="1"/>
            <rect x="-2.5" y="6" width="2" height="5" fill="#059669"/>
            <rect x="0.5" y="6" width="2" height="5" fill="#059669"/>
            <!-- Backpack -->
            <rect x="2" y="4" width="2" height="4" fill="#7C3AED" rx="1"/>
            </g>
            <!-- Child 3 - jumping near school entrance -->
            <g transform="translate(480, 280)">
            <animateTransform attributeName="transform" type="translate"
            values="480,280; 480,280; 480,275; 480,280; 580,285"
            dur="12s"
            repeatCount="indefinite"/>
            <circle cx="0" cy="0" r="3" fill="#34D399"/>
            <rect x="-2" y="3" width="4" height="8" fill="#EF4444" rx="1"/>
            <rect x="-2.5" y="6" width="2" height="5" fill="#DC2626"/>
            <rect x="0.5" y="6" width="2" height="5" fill="#DC2626"/>
            <!-- Backpack -->
            <rect x="2" y="4" width="2" height="4" fill="#F59E0B" rx="1"/>
            </g>
            <!-- Child 4 - jumping at school door -->
            <g transform="translate(580, 285)">
            <animateTransform attributeName="transform" type="translate"
            values="580,285; 580,285; 580,280; 580,285; 580,285"
            dur="12s"
            repeatCount="indefinite"/>
            <circle cx="0" cy="0" r="3" fill="#A78BFA"/>
            <rect x="-2" y="3" width="4" height="8" fill="#FBBF24" rx="1"/>
            <rect x="-2.5" y="6" width="2" height="5" fill="#F59E0B"/>
            <rect x="0.5" y="6" width="2" height="5" fill="#F59E0B"/>
            <!-- Backpack -->
            <rect x="2" y="4" width="2" height="4" fill="#06B6D4" rx="1"/>
            </g>
            </g>
            <!-- Festive decorations -->
            <g id="decorations">
            <!-- Pennant banners -->
            <line x1="450" y1="120" x2="650" y2="120" stroke="#8B4513" stroke-width="2"/>
            <g fill="#FF6B6B">
            <polygon points="460,120 470,125 460,130"/>
            <polygon points="480,120 490,125 480,130"/>
            <polygon points="500,120 510,125 500,130"/>
            <polygon points="520,120 530,125 520,130"/>
            <polygon points="540,120 550,125 540,130"/>
            <polygon points="560,120 570,125 560,130"/>
            <polygon points="580,120 590,125 580,130"/>
            <polygon points="600,120 610,125 600,130"/>
            <polygon points="620,120 630,125 620,130"/>
            </g>
            <!-- Balloons -->
            <g transform="translate(720, 200)">
            <line x1="0" y1="20" x2="0" y2="40" stroke="#333" stroke-width="1"/>
            <circle cx="0" cy="15" r="8" fill="#FF6B6B"/>
            <circle cx="-8" cy="18" r="6" fill="#4ECDC4"/>
            <circle cx="8" cy="18" r="6" fill="#45B7D1"/>
            </g>
            </g>
            <!-- Sky Text -->
            <g id="sky-text" transform="translate(400, 40)">
            <!-- Bold headline -->
            <text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">Destination reached.</text>
            <!-- Supporting description -->
            <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">Events arrive at the school — the application state is updated.</text>
            </g>
            <!-- Caption -->
            <g id="caption" transform="translate(400, 370)">
            <rect x="-220" y="-10" width="440" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
            <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Destination reached: application state updated (successful delivery)</text>
            </g>
          </g>
        </g>
      </g>
    

  <!-- Unified traveling bus (conditional) -->
  

  <!-- Progress indicator -->
  <g id="progress-indicator" transform="translate(50, 1450)">
    <rect x="0" y="0" width="1650" height="20"
          fill="#E0E0E0"
          stroke="#999"
          stroke-width="1"
          rx="10"/>
    <rect x="0" y="0" width="0" height="20"
          fill="#4CAF50"
          rx="10">
      <animate attributeName="width"
               values="0;1650"
               dur="30s"
               repeatCount="indefinite"/>
    </rect>
    <text x="825" y="35" text-anchor="middle"
          font-family="Arial, sans-serif"
          font-size="12"
          fill="#666">
      Journey Progress
    </text>
  </g>
</svg>